<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <title>step3b adding actions embedded - Chevrotain</title>
    <meta name="description" content="JavaScript Parser Building Toolkit" />
    <meta name="author" content="Shahar Soel">
    <meta charset="UTF-8">
    <link rel="icon" href="../themes/daux/img/favicon-blue.png" type="image/x-icon">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700&subset=latin,cyrillic-ext,cyrillic' rel='stylesheet' type='text/css'>
    <!-- CSS -->
    <link href='../themes/daux/css/theme-blue.min.css' rel='stylesheet' type='text/css'>
            <!-- Tipue Search -->
        <link href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body class=" ">
    <div class="Columns content">
    <aside class="Columns__left Collapsible">
        <button type="button" class="Button Collapsible__trigger">
            <span class="Collapsible__trigger--bar"></span>
            <span class="Collapsible__trigger--bar"></span>
            <span class="Collapsible__trigger--bar"></span>
        </button>

        <a class="Brand" href="../index.html">Chevrotain</a>

    <div class="Search">
        <svg class="Search__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451 451">
            <path d="M447.05 428l-109.6-109.6c29.4-33.8 47.2-77.9 47.2-126.1C384.65 86.2 298.35 0 192.35 0 86.25 0 .05 86.3.05 192.3s86.3 192.3 192.3 192.3c48.2 0 92.3-17.8 126.1-47.2L428.05 447c2.6 2.6 6.1 4 9.5 4s6.9-1.3 9.5-4c5.2-5.2 5.2-13.8 0-19zM26.95 192.3c0-91.2 74.2-165.3 165.3-165.3 91.2 0 165.3 74.2 165.3 165.3s-74.1 165.4-165.3 165.4c-91.1 0-165.3-74.2-165.3-165.4z"/>
        </svg>
        <input type="search" id="tipue_search_input" class="Search__field" placeholder="Search..." autocomplete="on"
               results=25 autosave=text_search>
    </div>

        <div class="Collapsible__content">
            <!-- Navigation -->
            <ul class='Nav'><li class='Nav__item Nav__item--open has-children'><a href="../Tutorial/src/README.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Tutorial</a><ul class='Nav'><li class='Nav__item  has-children'><a href="../Tutorial/src/README.html" class="folder"><i class="Nav__arrow">&nbsp;</i>src</a><ul class='Nav'><li class='Nav__item '><a href="../Tutorial/src/README.html">README</a></li></ul></li><li class='Nav__item '><a href="../Tutorial/step1_lexing.html">step1 lexing</a></li><li class='Nav__item '><a href="../Tutorial/step2_parsing.html">step2 parsing</a></li><li class='Nav__item '><a href="../Tutorial/step3_adding_actions_root.html">step3 adding actions root</a></li><li class='Nav__item '><a href="../Tutorial/step3a_adding_actions_visitor.html">step3a adding actions visitor</a></li><li class='Nav__item Nav__item--active'><a href="../Tutorial/step3b_adding_actions_embedded.html">step3b adding actions embedded</a></li><li class='Nav__item '><a href="../Tutorial/step4_fault_tolerance.html">step4 fault tolerance</a></li></ul></li><li class='Nav__item  has-children'><a href="../Deep_Dive/concrete_syntax_tree.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Deep Dive</a><ul class='Nav'><li class='Nav__item '><a href="../Deep_Dive/concrete_syntax_tree.html">concrete syntax tree</a></li><li class='Nav__item '><a href="../Deep_Dive/custom_token_patterns.html">custom token patterns</a></li><li class='Nav__item '><a href="../Deep_Dive/syntactic_content_assist.html">syntactic content assist</a></li></ul></li><li class='Nav__item  has-children'><a href="../Building_Grammars/resolving_grammar_errors.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Building Grammars</a><ul class='Nav'><li class='Nav__item '><a href="../Building_Grammars/resolving_grammar_errors.html">resolving grammar errors</a></li><li class='Nav__item '><a href="../Building_Grammars/resolving_lexer_errors.html">resolving lexer errors</a></li></ul></li><li class='Nav__item '><a href="../FAQ.html">FAQ</a></li><li class='Nav__item '><a href="../Roadmap.html">Roadmap</a></li></ul>

            <div class="Links">
                                    <hr/>
                                            <a href="http://sap.github.io/chevrotain/playground/" target="_blank">Online Playground</a>
                        <br />
                                            <a href="http://sap.github.io/chevrotain/performance/" target="_blank">Performance Benchmark</a>
                        <br />
                                            <a href="https://github.com/sap/chevrotain/issues" target="_blank">Help/Support/Bugs</a>
                        <br />
                                            <a href="https://github.com/sap/chevrotain" target="_blank">GitHub Repo</a>
                        <br />
                                    
                                    <div class="CodeToggler">
                        <hr/>
                                                    <a class="CodeToggler__button CodeToggler__button--main" href="#">Show Code Blocks Inline</a><br>
                                            </div>
                
                            </div>
        </div>
    </aside>
    <div class="Columns__right ">
        <div class="Columns__right__content">
            <div class="doc_content">
                <article class="Page">

    <div class="Page__header">
        <h1><a href="../Tutorial/src/README.html">Tutorial</a> <svg class="Page__header--separator" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 477.175 477.175"><path d="M360.73 229.075l-225.1-225.1c-5.3-5.3-13.8-5.3-19.1 0s-5.3 13.8 0 19.1l215.5 215.5-215.5 215.5c-5.3 5.3-5.3 13.8 0 19.1 2.6 2.6 6.1 4 9.5 4 3.4 0 6.9-1.3 9.5-4l225.1-225.1c5.3-5.2 5.3-13.8.1-19z"/></svg> <a href="../Tutorial/step3b_adding_actions_embedded.html">step3b adding actions embedded</a></h1>
                <span style="float: left; font-size: 10px; color: gray;">
            Thursday, December 21, 2017 6:41 AM        </span>
                        <span style="float: right; font-size: 10px; color: gray;">
            <a href="https://github.com/SAP/chevrotain/blob/master/docs/01_Tutorial/step3b_adding_actions_embedded.md" target="_blank">Edit on GitHub</a>
        </span>
            </div>


    <div class="s-content">
        <ul>
<li>Previous tutorial step - <a href="step2_parsing.html">Step 2 - Parsing</a>
</li>
</ul>
<h1 id="page_Tutorial-Step-3-Adding-Embedded-Actions-to-the-Parser">Tutorial Step 3 - Adding Embedded Actions to the Parser.</h1>
<h3 id="page_Source-Code-for-this-step">---&gt; <a href="https://github.com/SAP/chevrotain/blob/master/docs/01_tutorial/src/step3_actions/step3b_actions_embedded.js" class="external">Source Code</a> for this step &lt;---</h3>
<h3 id="page_On-code-samples">On code samples:</h3>
<p>The tutorial uses ES2015+ syntax.
See examples of using Chevrotain in other <a href="https://github.com/SAP/chevrotain/tree/master/examples/implementation_languages" class="external">implementation languages</a>.</p>
<h3 id="page_Introduction">Introduction:</h3>
<p>In the <a href="step2_parsing.html">previous</a> tutorial step
we have implemented a parser for a &quot;mini&quot; SQL Select grammar. The current problem is that our parser only
validates the input conforms to the grammar. In most real world use cases the parser will also have to output some
result/data structure/value.</p>
<p>This can be accomplished using two features of the Parsing DSL:</p>
<ul>
<li>
<a href="http://sap.github.io/chevrotain/documentation/1_0_0/classes/_chevrotain_d_.parser.html#consume1" class="external">CONSUME</a> will return
The <a href="http://sap.github.io/chevrotain/documentation/1_0_0/classes/_chevrotain_d_.token.html" class="external">Token</a> instance consumed.</li>
<li>
<a href="http://sap.github.io/chevrotain/documentation/1_0_0/classes/_chevrotain_d_.parser.html#subrule1" class="external">SUBRULE</a> will return
the result of the grammar rule invoked.</li>
</ul>
<h3 id="page_A-simple-contrived-example">A simple contrived example:</h3>
<pre><code class="language-javascript">$.RULE(&quot;topRule&quot;, () =&gt; {
    let result = 0
    
    $.MANY(() =&gt; {
        $.OR([
            {ALT: () =&gt; { result += $.SUBRULE($.decimalRule)}},
            {ALT: () =&gt; { result += $.SUBRULE($.IntegerRule)}}
        ])
    })
    
    return result
})
   
$.RULE(&quot;decimalRule&quot;, () =&gt; {
    let decimalToken = $.CONSUME(Decimal)
    return parseFloat(decimalToken.image)
  
})

$.RULE(&quot;IntegerRule&quot;, () =&gt; {
    let intToken = $.CONSUME(Integer)
    return parseInt(intToken.image)
})
</code></pre>
<p>The <strong>decimalRule</strong> and <strong>IntegerRule</strong> both return a javascript number (using parseInt/parseFloat).
and the <strong>topRule</strong> adds it to the final result.</p>
<h4 id="page_Back-To-the-mini-SQL-Select-grammar">Back To the mini SQL Select grammar:</h4>
<p>For this grammar lets build a more complex data structure (an AST) instead of simply returning a number.
Our selectStatement rule will now return an object with four properties:</p>
<pre><code class="language-javascript">$.RULE(&quot;selectStatement&quot;, () =&gt; {
    let select, from, where
    
    select = $.SUBRULE($.selectClause)
    from = $.SUBRULE($.fromClause)
    $.OPTION(() =&gt; {
       where = $.SUBRULE($.whereClause)
    })
    
    return {
        type         : &quot;SELECT_STMT&quot;, 
        selectClause : select,
        fromClause   : from, 
        // may be undefined if the OPTION was not entered.
        whereClause  : where
    }
})
</code></pre>
<p>Three of those properties (selectClause / fromClause / whereClause) are the results of invoking
other parser rules.</p>
<p>Lets look at the &quot;selectClause&quot; rule implemntaiton:</p>
<pre><code class="language-javascript">$.RULE(&quot;selectClause&quot;, () =&gt; {
    let columns = []
    
    $.CONSUME(Select);
    $.AT_LEAST_ONE_SEP({SEP:Comma, DEF:() =&gt; {
       // accessing a token's string via getImage utility
       columns.push($.CONSUME(Identifier).image)
    }})

    return {
        type    : &quot;SELECT_CLAUSE&quot;, 
        columns : columns
    }
})
</code></pre>
<p>In the selectClause rule we access the <strong>image</strong> property of the Identifier token returned from <strong>CONSUME</strong>
and push each of these strings to the <strong>columns</strong> array.</p>
<h4 id="page_What-is-Next">What is Next?</h4>
<ul>
<li>Run &amp; Debug the <a href="https://github.com/SAP/chevrotain/blob/master/docs/01_tutorial/src/step3a_actions_visitor" class="external">source code</a> of
this tutorial step.</li>
<li>Next step in the tutorial: <a href="step4_fault_tolerance.html">Step 4 - Fault Tolerance</a>.</li>
</ul>
    </div>

        <nav>
        <ul class="Pager">
            <li class=Pager--prev><a href="../Tutorial/step3a_adding_actions_visitor.html">Previous</a></li>            <li class=Pager--next><a href="../Tutorial/step4_fault_tolerance.html">Next</a></li>        </ul>
    </nav>
    </article>

            </div>
        </div>
    </div>
</div>

    
    <!-- jQuery -->
    <script src="../themes/daux/js/jquery-1.11.3.min.js"></script>

    <!-- hightlight.js -->
    <script src="../themes/daux/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <script src="../themes/daux/js/daux.js"></script>

            <!-- Tipue Search -->
        <script type="text/javascript" src="../tipuesearch/tipuesearch.js"></script>

        <script>
            window.onunload = function(){}; // force $(document).ready to be called on back/forward navigation in firefox
            $(function() {
                tipuesearch({
                    'base_url': '../'
                });
            });
        </script>
    
</body>
</html>
