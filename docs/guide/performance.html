<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Optimizing a Parser for Performance | Chevrotain</title>
    <meta name="description" content="Parser Building Toolkit for JavaScript">
    
    
    <link rel="preload" href="/chevrotain/docs/assets/css/0.styles.edb40e5d.css" as="style"><link rel="preload" href="/chevrotain/docs/assets/js/app.d8a37e4a.js" as="script"><link rel="preload" href="/chevrotain/docs/assets/js/11.7814907b.js" as="script"><link rel="prefetch" href="/chevrotain/docs/assets/js/21.d9c901ce.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/1.996567ea.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/2.f9c15e24.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/3.e392f582.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/4.c8cb870c.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/5.a25f3797.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/6.cbc02bab.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/7.f5b6c88e.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/8.96a42f35.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/9.1dc6e163.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/10.fdffc9e7.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/12.e6e3e34a.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/13.4aa8eeb7.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/14.ce9675e8.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/15.e73915cb.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/16.155053e5.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/17.d57c8495.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/18.443268de.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/19.067a329e.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/20.9e1cc699.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/22.d1132728.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/23.67923cb8.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/24.9d0396ac.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/25.8a21a7e0.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/26.7b92bc61.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/27.3eb2fce6.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/28.07c165bf.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/29.9ebd28c2.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/30.13c0cfee.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/31.a88ff2ad.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/32.2bd7d532.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/33.690ccfd9.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/34.5157cdfa.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/35.e98e79fb.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/36.0bb4960e.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/37.c7d7a7dc.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/38.5d0f7236.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/39.260c7107.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/40.6d9f704a.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/41.0c51c2fe.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/42.239018c2.js"><link rel="prefetch" href="/chevrotain/docs/assets/js/43.a8003d95.js">
    <link rel="stylesheet" href="/chevrotain/docs/assets/css/0.styles.edb40e5d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/chevrotain/docs/" class="home-link router-link-active"><!----> <span class="site-name">Chevrotain</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/chevrotain/docs/" class="nav-link">Home</a></div><div class="nav-item"><a href="/chevrotain/docs/features/blazing_fast.html" class="nav-link">Features</a></div><div class="nav-item"><a href="/chevrotain/docs/tutorial/step0_introduction.html" class="nav-link">Tutorial</a></div><div class="nav-item"><a href="/chevrotain/docs/guide/introduction.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="/chevrotain/docs/FAQ.html" class="nav-link">FAQ</a></div><div class="nav-item"><a href="/chevrotain/docs/changes/BREAKING_CHANGES.html" class="nav-link">Changes</a></div><div class="nav-item"><a href="https://sap.github.io/chevrotain/documentation/3_7_4/globals.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  APIs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://sap.github.io/chevrotain/playground/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Playground
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://sap.github.io/chevrotain/performance/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Benchmark
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://gitter.im/chevrotain-parser/Lobby" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chat
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/SAP/chevrotain" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/chevrotain/docs/" class="nav-link">Home</a></div><div class="nav-item"><a href="/chevrotain/docs/features/blazing_fast.html" class="nav-link">Features</a></div><div class="nav-item"><a href="/chevrotain/docs/tutorial/step0_introduction.html" class="nav-link">Tutorial</a></div><div class="nav-item"><a href="/chevrotain/docs/guide/introduction.html" class="nav-link">Guide</a></div><div class="nav-item"><a href="/chevrotain/docs/FAQ.html" class="nav-link">FAQ</a></div><div class="nav-item"><a href="/chevrotain/docs/changes/BREAKING_CHANGES.html" class="nav-link">Changes</a></div><div class="nav-item"><a href="https://sap.github.io/chevrotain/documentation/3_7_4/globals.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  APIs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://sap.github.io/chevrotain/playground/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Playground
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://sap.github.io/chevrotain/performance/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Benchmark
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://gitter.im/chevrotain-parser/Lobby" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Chat
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/SAP/chevrotain" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/chevrotain/docs/guide/introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/chevrotain/docs/guide/performance.html" class="active sidebar-link">Performance</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/chevrotain/docs/guide/performance.html#singleton-parser" class="sidebar-link">Singleton Parser</a></li><li class="sidebar-sub-header"><a href="/chevrotain/docs/guide/performance.html#lexer-optimizations" class="sidebar-link">Lexer Optimizations</a></li><li class="sidebar-sub-header"><a href="/chevrotain/docs/guide/performance.html#arrays-of-alternatives" class="sidebar-link">Arrays of Alternatives</a></li><li class="sidebar-sub-header"><a href="/chevrotain/docs/guide/performance.html#minor-optimizations" class="sidebar-link">Minor Optimizations</a></li></ul></li><li><a href="/chevrotain/docs/guide/concrete_syntax_tree.html" class="sidebar-link">CST</a></li><li><a href="/chevrotain/docs/guide/generating_syntax_diagrams.html" class="sidebar-link">Syntax Diagrams</a></li><li><a href="/chevrotain/docs/guide/custom_token_patterns.html" class="sidebar-link">Custom Token Patterns</a></li><li><a href="/chevrotain/docs/guide/syntactic_content_assist.html" class="sidebar-link">Syntactic Content Assist</a></li><li><a href="/chevrotain/docs/guide/custom_apis.html" class="sidebar-link">Custom APIs</a></li><li><a href="/chevrotain/docs/guide/resolving_grammar_errors.html" class="sidebar-link">Resolving Grammar Errors</a></li><li><a href="/chevrotain/docs/guide/resolving_lexer_errors.html" class="sidebar-link">Resolving Lexer Errors</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="optimizing-a-parser-for-performance"><a href="#optimizing-a-parser-for-performance" aria-hidden="true" class="header-anchor">#</a> Optimizing a Parser for Performance</h1> <h2 id="singleton-parser"><a href="#singleton-parser" aria-hidden="true" class="header-anchor">#</a> Singleton Parser</h2> <p>Do not create a new Parser instance for each new input
Instead re-use a single instance and reset its state between iterations. For example:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// reuse the same parser instance.</span>
<span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonParser</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> lexResult <span class="token operator">=</span> JsonLexer<span class="token punctuation">.</span><span class="token function">tokenize</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>

    <span class="token comment">// setting a new input will RESET the parser instance's state.</span>
    parser<span class="token punctuation">.</span>input <span class="token operator">=</span> lexResult<span class="token punctuation">.</span>tokens

    <span class="token keyword">const</span> value <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        value<span class="token punctuation">:</span> value<span class="token punctuation">,</span>
        lexErrors<span class="token punctuation">:</span> lexResult<span class="token punctuation">.</span>errors<span class="token punctuation">,</span>
        parseErrors<span class="token punctuation">:</span> parser<span class="token punctuation">.</span>errors
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Avoiding creating new instances is imperative because Chevrotain lazy evaluates and caches
many computations required for its execution, This cache is kept on the instance level
So creating a new Parser instance for each input would lose all advantages of this cache.</p> <p>Note that this means that if your parser &quot;carries&quot; additional state, that state should also be reset.
Simply override the Parser's <a href="https://sap.github.io/chevrotain/documentation/3_7_4/classes/parser.html#reset" target="_blank" rel="noopener noreferrer">reset<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> method
to accomplish that.</p> <h2 id="lexer-optimizations"><a href="#lexer-optimizations" aria-hidden="true" class="header-anchor">#</a> Lexer Optimizations</h2> <p>Ensure that the lexer's optimizations are enabled.
The Chevrotain Lexer performs optimizations by filtering the potential token matchs
using the next <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/charCodeAt" target="_blank" rel="noopener noreferrer">charCode<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to be consumed.
These optimizattions can provide anywhere from a <strong>30% boost</strong> for small lexers
to <strong>several multipiles</strong> improvment in large Lexers with many TokenTypes.</p> <p>To apply this optimization the first possible charCodes for <strong>every</strong> TokenType must be identified.
Sometimes a TokenType's first charCodes cannot be automatically identified.
In that case the lexer will <strong>silently</strong> revert to using the unoptimized algorithims.</p> <p>It it possible to configure the Lexer <strong>throw</strong> an error
in case the optimizations cannot be enabled by turning on the
&quot;ensureOptimizations&quot; flag:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Lexer <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;chevrotain&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> myLexer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Lexer</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span>
        <span class="token comment">/* tokens */</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> ensureOptimizations<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre></div><p>With the &quot;ensureOptimizations&quot; flag enabled the Lexer will also print error messages
to the console with details on how to resolve optimiations errors.</p> <h2 id="arrays-of-alternatives"><a href="#arrays-of-alternatives" aria-hidden="true" class="header-anchor">#</a> Arrays of Alternatives</h2> <p>The syntax for alternatives (OR) requires creating an array on every <strong>single</strong> invocation.
For large enough arrays and in rules which are called often this can cause quite a large performance penalty.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>$<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    $<span class="token punctuation">.</span><span class="token constant">OR</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token comment">// an array with seven alternatives</span>
        <span class="token punctuation">{</span> <span class="token constant">ALT</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>StringLiteral<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token constant">ALT</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>NumberLiteral<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token constant">ALT</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">SUBRULE</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>object<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token constant">ALT</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">SUBRULE</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>array<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token constant">ALT</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>True<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token constant">ALT</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>False<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token constant">ALT</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>Null<span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>A simple JavaScript pattern can avoid this costly re-initialization:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>$<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// c1 is used as a cache, the short circute &quot;||&quot; will ensure only a single initialization</span>
    $<span class="token punctuation">.</span><span class="token constant">OR</span><span class="token punctuation">(</span>
        $<span class="token punctuation">.</span>c1 <span class="token operator">||</span>
            <span class="token punctuation">(</span>$<span class="token punctuation">.</span>c1 <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span> <span class="token constant">ALT</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>StringLiteral<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span> <span class="token constant">ALT</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>NumberLiteral<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span> <span class="token constant">ALT</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">SUBRULE</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>object<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span> <span class="token constant">ALT</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">SUBRULE</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>array<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span> <span class="token constant">ALT</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>True<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span> <span class="token constant">ALT</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>False<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token punctuation">{</span> <span class="token constant">ALT</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>Null<span class="token punctuation">)</span> <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Applying this pattern (in just a single location) on a JSON grammar provided 25-30% performance boost
(Node.js 8), For a CSS grammar (2 locations) this resulted in about 20% speed boost.</p> <p>It is important to note that:</p> <ul><li><p>This pattern should only be applied on largish number of alternatives, testing on node.js 8.0 showed
it was only useful when there are at least four alternatives. In cases with fewer alternatives this pattern
would actually be <strong>slower</strong>!</p></li> <li><p>This pattern can only be applied if there are no vars which can be accessed via closures.
Example:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// BAD</span>
$<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result
    <span class="token comment">// We reference the &quot;result&quot; variable via a closure.</span>
    <span class="token comment">// So a new function is needed each time this grammar rule is invoked.</span>
    $<span class="token punctuation">.</span><span class="token constant">OR</span><span class="token punctuation">(</span>
        $<span class="token punctuation">.</span>c1 <span class="token operator">||</span>
            <span class="token punctuation">(</span>$<span class="token punctuation">.</span>c1 <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token constant">ALT</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        result <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>StringLiteral<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// GOOD</span>
$<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> result
    <span class="token comment">// no closure for the result variable, we use the returned value of the OR instead.</span>
    result <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">OR</span><span class="token punctuation">(</span>
        $<span class="token punctuation">.</span>c1 <span class="token operator">||</span>
            <span class="token punctuation">(</span>$<span class="token punctuation">.</span>c1 <span class="token operator">=</span> <span class="token punctuation">[</span>
                <span class="token punctuation">{</span>
                    <span class="token constant">ALT</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>StringLiteral<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>Note that gates often use vars from closures.</li></ul></li> <li><p>Due to the way Chevrotain is built, the text of the alternatives cannot be completely extracted from the grammar rule</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// defined outside the rule</span>
<span class="token keyword">const</span> myAlts <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
        <span class="token constant">ALT</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>StringLiteral<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

<span class="token comment">// Won't work</span>
$<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Chevrotain won't be able to analyze this grammar rule as it relies on Function.prototype.toString</span>
    result <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">OR</span><span class="token punctuation">(</span>myAlts<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><p>Avoid dynamically changing the parser instance. The line:</p> <blockquote><p>&quot;$.c1 || ($.c1 = ...&quot; ($ is 'this')</p></blockquote> <p>Will cause a 'c1' property to be assigned to the parser instance.
This may seem innocent but if enough properties are added dynamically to an instance
its V8 hidden class will change which could cause a severe performance reduction.</p> <p>To avoid this, simply define these &quot;cache properties&quot; in the constructor.
See an example in the <a href="https://github.com/SAP/chevrotain/blob/ac21570b97a8de0d6b91f29979aed8041455cacd/examples/grammars/ecma5/ecma5_parser.js#L37-L43" target="_blank" rel="noopener noreferrer">ECMAScript5 grammar's constructor<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p></li></ul> <h2 id="minor-optimizations"><a href="#minor-optimizations" aria-hidden="true" class="header-anchor">#</a> Minor Optimizations</h2> <p>These are only required if you are trying to squeeze every tiny bit of performance out of your parser.</p> <ol><li><p><strong>Reduce the amount of Token position tracking</strong> the lexer performs.
See The <a href="https://sap.github.io/chevrotain/documentation/3_7_4/interfaces/ilexerconfig.html" target="_blank" rel="noopener noreferrer">ILexerConfig.positionTracking<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> property.</p></li> <li><p><strong>Avoid creating parsing rules which only parse a single Terminal.</strong></p> <p>There is a certain fixed overhead for the invocation of each parsing rule.
Normally there is no reason to pay it for a Rule which only consumes a single Terminal.
For example:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span>myRedundantRule <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;myRedundantRule&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>StringLiteral<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>Instead such a rule's contents should be (manually) in-lined in its call sites.</p></li> <li><p><strong>Avoid *_SEP DSL methods (MANY_SEP / AT_LEAST_ONE_SEP).</strong></p> <p>The *_SEP DSL methods also collect the separator Tokens parsed. Creating these arrays has a small overhead (several percentage).
Which is a complete waste in most cases where those separators tokens are not needed for any output data structure.</p></li> <li><p><strong>Use the returned values of iteration DSL methods (MANY/MANY_SEP/AT_LEAST_ONE/AT_LEAST_ONE_SEP).</strong></p> <p>Consider the following grammar rule:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;array&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> myArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>LSquare<span class="token punctuation">)</span>
    values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token constant">SUBRULE</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
    $<span class="token punctuation">.</span><span class="token constant">MANY</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>Comma<span class="token punctuation">)</span>
        values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token constant">SUBRULE2</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>RSquare<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>The values of the array are manually collected inside the &quot;myArr&quot; array.
However another result array is already created by invoking the iteration DSL method &quot;MANY&quot;
This is obviously a waste of cpu cycles...</p> <p>A slightly more efficient (but syntactically ugly) alternative would be:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;array&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> myArr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>LSquare<span class="token punctuation">)</span>
    values<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token constant">SUBRULE</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">let</span> iterationResult <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">MANY</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>Comma<span class="token punctuation">)</span>
        <span class="token keyword">return</span> $<span class="token punctuation">.</span><span class="token constant">SUBRULE2</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    myArr <span class="token operator">=</span> myArr<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>iterationResult<span class="token punctuation">)</span>
    $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>RSquare<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li></ol></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/SAP/chevrotain/edit/master/docs/guide/performance.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/chevrotain/docs/guide/introduction.html" class="prev">
          Introduction
        </a></span> <span class="next"><a href="/chevrotain/docs/guide/concrete_syntax_tree.html">
          CST
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/chevrotain/docs/assets/js/11.7814907b.js" defer></script><script src="/chevrotain/docs/assets/js/app.d8a37e4a.js" defer></script>
  </body>
</html>
