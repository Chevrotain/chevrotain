<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.26" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>Internals | Chevrotain</title><meta name="description" content="Parser Building Toolkit for JavaScript">
    <link rel="preload" href="/docs/assets/style-C_1sbLzA.css" as="style"><link rel="stylesheet" href="/docs/assets/style-C_1sbLzA.css">
    <link rel="modulepreload" href="/docs/assets/app-BSd0-oVw.js"><link rel="modulepreload" href="/docs/assets/internals.html-Bnm5R0IG.js">
    <link rel="prefetch" href="/docs/assets/FAQ.html-DHcZRkHr.js" as="script"><link rel="prefetch" href="/docs/assets/index.html-Club9eAt.js" as="script"><link rel="prefetch" href="/docs/assets/BREAKING_CHANGES.html-DhQQxP8w.js" as="script"><link rel="prefetch" href="/docs/assets/CHANGELOG.html-BTio3MCU.js" as="script"><link rel="prefetch" href="/docs/assets/backtracking.html-DaGjiYAZ.js" as="script"><link rel="prefetch" href="/docs/assets/blazing_fast.html-BRL70B04.js" as="script"><link rel="prefetch" href="/docs/assets/custom_errors.html-CotBErWz.js" as="script"><link rel="prefetch" href="/docs/assets/custom_token_patterns.html-D3uYsrU0.js" as="script"><link rel="prefetch" href="/docs/assets/easy_debugging.html-BHlqnxfe.js" as="script"><link rel="prefetch" href="/docs/assets/fault_tolerance.html-BfEaIrmT.js" as="script"><link rel="prefetch" href="/docs/assets/gates.html-D05Zhy6V.js" as="script"><link rel="prefetch" href="/docs/assets/grammar_inheritance.html-BIc7oxDm.js" as="script"><link rel="prefetch" href="/docs/assets/lexer_modes.html-CJ0qJHiV.js" as="script"><link rel="prefetch" href="/docs/assets/llk.html-0jgcD3U0.js" as="script"><link rel="prefetch" href="/docs/assets/multiple_start_rules.html-BM2gyH42.js" as="script"><link rel="prefetch" href="/docs/assets/parameterized_rules.html-DWQECnKD.js" as="script"><link rel="prefetch" href="/docs/assets/position_tracking.html-BFQ-e7g5.js" as="script"><link rel="prefetch" href="/docs/assets/regexp.html-DdENCal1.js" as="script"><link rel="prefetch" href="/docs/assets/separation.html-Cl1-RHU9.js" as="script"><link rel="prefetch" href="/docs/assets/syntactic_content_assist.html-mWyn0Pxq.js" as="script"><link rel="prefetch" href="/docs/assets/syntax_diagrams.html-CbfnxXls.js" as="script"><link rel="prefetch" href="/docs/assets/token_alternative_matches.html-eurJzNij.js" as="script"><link rel="prefetch" href="/docs/assets/token_categories.html-uKNHhZ4j.js" as="script"><link rel="prefetch" href="/docs/assets/token_grouping.html-Dp6jbwFz.js" as="script"><link rel="prefetch" href="/docs/assets/token_skipping.html-DWukYqc9.js" as="script"><link rel="prefetch" href="/docs/assets/concrete_syntax_tree.html-C7hiKzih.js" as="script"><link rel="prefetch" href="/docs/assets/custom_token_patterns.html-DNVgHlx5.js" as="script"><link rel="prefetch" href="/docs/assets/generating_syntax_diagrams.html-BVsyEnBR.js" as="script"><link rel="prefetch" href="/docs/assets/initialization_performance.html-2ns6Tr5b.js" as="script"><link rel="prefetch" href="/docs/assets/introduction.html-mjjMOtlM.js" as="script"><link rel="prefetch" href="/docs/assets/performance.html-lVCuNYuU.js" as="script"><link rel="prefetch" href="/docs/assets/resolving_grammar_errors.html-6y95x3jO.js" as="script"><link rel="prefetch" href="/docs/assets/resolving_lexer_errors.html-ByukhJcQ.js" as="script"><link rel="prefetch" href="/docs/assets/syntactic_content_assist.html-BV4PaF7H.js" as="script"><link rel="prefetch" href="/docs/assets/step0_introduction.html-fTG2E_It.js" as="script"><link rel="prefetch" href="/docs/assets/step1_lexing.html-rDVB8e1k.js" as="script"><link rel="prefetch" href="/docs/assets/step2_parsing.html-CWiFswkd.js" as="script"><link rel="prefetch" href="/docs/assets/step3_adding_actions_root.html-DUmCW5jA.js" as="script"><link rel="prefetch" href="/docs/assets/step3a_adding_actions_visitor.html-C70r8Z4W.js" as="script"><link rel="prefetch" href="/docs/assets/step3b_adding_actions_embedded.html-D1RmoNM9.js" as="script"><link rel="prefetch" href="/docs/assets/step4_fault_tolerance.html-_TRWAkbx.js" as="script"><link rel="prefetch" href="/docs/assets/404.html-D7Fes3VN.js" as="script"><link rel="prefetch" href="/docs/assets/index-BuqEEp8M.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/docs/"><!----><span class="vp-site-name" aria-hidden="true">Chevrotain</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/docs/" aria-label="Home"><!--[--><!--[--><!--]--><!--]-->Home<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/docs/features/blazing_fast.html" aria-label="Features"><!--[--><!--[--><!--]--><!--]-->Features<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/docs/tutorial/step0_introduction.html" aria-label="Tutorial"><!--[--><!--[--><!--]--><!--]-->Tutorial<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/docs/guide/introduction.html" aria-label="Guide"><!--[--><!--[--><!--]--><!--]-->Guide<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/docs/FAQ.html" aria-label="FAQ"><!--[--><!--[--><!--]--><!--]-->FAQ<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/docs/changes/BREAKING_CHANGES.html" aria-label="Changes"><!--[--><!--[--><!--]--><!--]-->Changes<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://chevrotain.io/documentation/11_1_2/index.html" aria-label="APIs" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->APIs<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://chevrotain.io/playground/" aria-label="Playground" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Playground<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://chevrotain.io/performance/" aria-label="Benchmark" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Benchmark<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/Chevrotain/chevrotain/discussions" aria-label="Discussions" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Discussions<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/chevrotain/chevrotain" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->GitHub<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!--[--><div id="docsearch-container" style="display:none;"></div><div class="docsearch-placeholder"><button type="button" aria-label="Search" aria-keyshortcuts="Control+k" class="DocSearch DocSearch-Button"><span class="DocSearch-Button-Container"><svg width="20" height="20" viewBox="0 0 24 24" aria-hidden="true" class="DocSearch-Search-Icon"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key DocSearch-Button-Key--ctrl">Ctrl</kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/docs/" aria-label="Home"><!--[--><!--[--><!--]--><!--]-->Home<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/docs/features/blazing_fast.html" aria-label="Features"><!--[--><!--[--><!--]--><!--]-->Features<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/docs/tutorial/step0_introduction.html" aria-label="Tutorial"><!--[--><!--[--><!--]--><!--]-->Tutorial<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/docs/guide/introduction.html" aria-label="Guide"><!--[--><!--[--><!--]--><!--]-->Guide<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/docs/FAQ.html" aria-label="FAQ"><!--[--><!--[--><!--]--><!--]-->FAQ<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/docs/changes/BREAKING_CHANGES.html" aria-label="Changes"><!--[--><!--[--><!--]--><!--]-->Changes<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://chevrotain.io/documentation/11_1_2/index.html" aria-label="APIs" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->APIs<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://chevrotain.io/playground/" aria-label="Playground" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Playground<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://chevrotain.io/performance/" aria-label="Benchmark" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Benchmark<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/Chevrotain/chevrotain/discussions" aria-label="Discussions" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->Discussions<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/chevrotain/chevrotain" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->GitHub<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">Guide <!----></p><ul class="vp-sidebar-children" style=""><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/docs/guide/introduction.html" aria-label="Introduction"><!--[--><!--[--><!--]--><!--]-->Introduction<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/docs/guide/performance.html" aria-label="Runtime Performance"><!--[--><!--[--><!--]--><!--]-->Runtime Performance<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/docs/guide/initialization_performance.html" aria-label="Initialization Performance"><!--[--><!--[--><!--]--><!--]-->Initialization Performance<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/docs/guide/concrete_syntax_tree.html" aria-label="CST"><!--[--><!--[--><!--]--><!--]-->CST<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/docs/guide/generating_syntax_diagrams.html" aria-label="Syntax Diagrams"><!--[--><!--[--><!--]--><!--]-->Syntax Diagrams<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/docs/guide/custom_token_patterns.html" aria-label="Custom Token Patterns"><!--[--><!--[--><!--]--><!--]-->Custom Token Patterns<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/docs/guide/syntactic_content_assist.html" aria-label="Syntactic Content Assist"><!--[--><!--[--><!--]--><!--]-->Syntactic Content Assist<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/docs/guide/internals.html" aria-label="Internals"><!--[--><!--[--><!--]--><!--]-->Internals<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/docs/guide/resolving_grammar_errors.html" aria-label="Resolving Grammar Errors"><!--[--><!--[--><!--]--><!--]-->Resolving Grammar Errors<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/docs/guide/resolving_lexer_errors.html" aria-label="Resolving Lexer Errors"><!--[--><!--[--><!--]--><!--]-->Resolving Lexer Errors<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="internals" tabindex="-1"><a class="header-anchor" href="#internals"><span>Internals</span></a></h1><p>Chevrotain provides an abstraction for building Parsers; however, no abstraction is perfect, and at some point understanding the implementation details may become necessary.</p><h2 id="grammar-recording" tabindex="-1"><a class="header-anchor" href="#grammar-recording"><span>Grammar Recording</span></a></h2><h4 id="tldr" tabindex="-1"><a class="header-anchor" href="#tldr"><span>TLDR</span></a></h4><p>Wrap any semantic actions that cause runtime errors during the recording phase or have global side effects with the <a href="https://chevrotain.io/documentation/11_1_2/classes/BaseParser.html#ACTION" target="_blank" rel="noopener noreferrer">ACTION DSL method</a> to resolve issues.</p><h3 id="the-problem" tabindex="-1"><a class="header-anchor" href="#the-problem"><span>The Problem</span></a></h3><p><strong><em>Chevrotain needs to &quot;understand&quot; the grammar structure in order to run.</em></strong></p><p>For example, in an alternation Chevrotain must be able to choose the right alternative to process, but in order to do so the <strong>contents</strong> (Grammar) of each alternative must be known <strong>in advance</strong>.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">$<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// The choice of which alternative to pick</span></span>
<span class="line">  <span class="token comment">// is done by the &quot;OR&quot; (alternation) method, by **looking ahead** in the token vector.</span></span>
<span class="line">  <span class="token comment">// But making this choice requires **knowing** in advance the full structure of the grammar.</span></span>
<span class="line">  $<span class="token punctuation">.</span><span class="token constant">OR</span><span class="token punctuation">(</span><span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token function-variable function">ALT</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>StringLiteral<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token function-variable function">ALT</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>NumberLiteral<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token function-variable function">ALT</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">SUBRULE</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>object<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token function-variable function">ALT</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">SUBRULE</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>array<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token function-variable function">ALT</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>True<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token function-variable function">ALT</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>False<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">{</span> <span class="token function-variable function">ALT</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>Null<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="the-solution" tabindex="-1"><a class="header-anchor" href="#the-solution"><span>The Solution</span></a></h3><p>Chevrotain solves the problem of &quot;understanding&quot; the grammar structure by running the Parser in a &quot;Recording Mode&quot; with <strong>alternative implementations</strong> of the parsing methods (OR/MANY/OPTION/...). The results of these &quot;recordings&quot; are saved on the Parser instance and are accessible via the <a href="https://chevrotain.io/documentation/11_1_2/classes/BaseParser.html#getGAstProductions" target="_blank" rel="noopener noreferrer">getGastProductions</a> method. However, for this to work successfully there are a couple of implicit assumptions.</p><h3 id="assumption-1-the-parser-won-t-throw-errors-during-recording" tabindex="-1"><a class="header-anchor" href="#assumption-1-the-parser-won-t-throw-errors-during-recording"><span>Assumption 1 - The Parser won&#39;t throw errors during recording.</span></a></h3><p>Any error thrown during the recording phase will obviously fail the recording and thus make the parser unusable. These are normally easy to fix and identify by an end user, as the runtime error message will be modified (by Chevrotain) to indicate it occurred during the &quot;recording phase&quot; and the stack trace will easily &quot;point&quot; the end user towards the source of the problem.</p><p>Let us inspect some scenarios to fully understand the problem. The root issue is making assumptions about the structure and values returned by the Parsing DSL methods. Let&#39;s first consider an example that will <strong>not</strong> cause an error.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">SafeEmbeddedActionsExample</span> <span class="token keyword">extends</span> <span class="token class-name">EmbeddedActionsParser</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">/* ... */</span></span>
<span class="line">    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;objectItem&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// Usage of the Parsing DSL methods is always safe, otherwise the whole concept of &quot;grammar recording&quot; would not work...</span></span>
<span class="line">      <span class="token keyword">const</span> keyTok <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>StringLiteral<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>Colon<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">const</span> valAst <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">SUBRULE</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// strip away the quotes from the string literal</span></span>
<span class="line">      <span class="token comment">// Note that even during the &quot;recording phase&quot; the CONSUME method will return an object that matches the IToken interface</span></span>
<span class="line">      <span class="token comment">// to reduce potential runtime errors, so this is safe.</span></span>
<span class="line">      <span class="token keyword">const</span> keyName <span class="token operator">=</span> keyTok<span class="token punctuation">.</span>image<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> keyTok<span class="token punctuation">.</span>image<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// Assembling this JS object literal won&#39;t cause any issues because</span></span>
<span class="line">      <span class="token comment">// we are not actually doing anything with the returned values.</span></span>
<span class="line">      <span class="token comment">// Only assigning them to properties in a new object (which is always safe)</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;keyValuePair&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">key</span><span class="token operator">:</span> keyName<span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">value</span><span class="token operator">:</span> valAst<span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>So we saw that a common use case of using embedded semantic actions to construct an AST is normally safe during the &quot;recording&quot; phase. Let&#39;s consider some situations that will actually cause errors.</p><h4 id="example-1-making-assumptions-on-the-returned-structure-by-a-subrule-call" tabindex="-1"><a class="header-anchor" href="#example-1-making-assumptions-on-the-returned-structure-by-a-subrule-call"><span>Example 1: Making assumptions on the returned structure by a SUBRULE call</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">ErrorEmbeddedActions1</span> <span class="token keyword">extends</span> <span class="token class-name">EmbeddedActionsParser</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">/* ... */</span></span>
<span class="line">    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;topRule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// During the recording phase `SUBRULE` will return a &quot;dummy&quot; value</span></span>
<span class="line">      <span class="token comment">// Which would not match the structure `otherRule` normally returns.</span></span>
<span class="line">      <span class="token keyword">const</span> otherRuleVal <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">SUBRULE</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>otherRule<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// Will cause &quot;undefined is not an object&quot; runtime error</span></span>
<span class="line">      <span class="token comment">// because during the recording phase `SUBRULE` will not return the expected value.</span></span>
<span class="line">      <span class="token keyword">return</span> otherRuleVal<span class="token punctuation">.</span>foo<span class="token punctuation">.</span>bar<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;otherRule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> myTok <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>MyTok<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">bar</span><span class="token operator">:</span> myTok<span class="token punctuation">.</span>image<span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="example-2-making-assumptions-on-the-returned-value-by-dsl-method-calls" tabindex="-1"><a class="header-anchor" href="#example-2-making-assumptions-on-the-returned-value-by-dsl-method-calls"><span>Example 2: Making assumptions on the returned value by DSL Method calls</span></a></h4><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">ErrorSemanticChecks</span> <span class="token keyword">extends</span> <span class="token class-name">EmbeddedActionsParser</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">/* ... */</span></span>
<span class="line">    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;semanticCheckRule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// During the recording phase `CONSUME` will return a &quot;dummy&quot; IToken value.</span></span>
<span class="line">      <span class="token keyword">const</span> myNumTok <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>NumberTok<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">// The &quot;dummy&quot; IToken `image` is not a number so this will evaluate to NaN.</span></span>
<span class="line">      <span class="token keyword">const</span> numValue <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>myNumTok<span class="token punctuation">.</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token comment">// Our embedded semantic check will **always** throw during the recording phase because</span></span>
<span class="line">      <span class="token comment">// the &quot;mocked&quot; IToken returned by `CONSUME` would never be a valid integer.</span></span>
<span class="line">      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>numValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Unexpected Number Value!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">return</span> numValue<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="common-denominator-embedded-actions" tabindex="-1"><a class="header-anchor" href="#common-denominator-embedded-actions"><span>Common Denominator: Embedded Actions</span></a></h4><p>Before moving on to possible solutions, note that all the above examples are centered around using Parsers with <strong>embedded actions</strong>. When using the alternative: a Parser that outputs a <a class="route-link" href="/docs/guide/concrete_syntax_tree.html">Concrete Syntax Tree</a> which is the <a class="route-link" href="/docs/tutorial/step3_adding_actions_root.html#alternatives">recommended approach</a>, there would be very few (if any) embedded actions in the grammar. Thus it is a lot less likely that a CstParser would raise errors during the recording phase, e.g.:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">JsonParser</span> <span class="token keyword">extends</span> <span class="token class-name">CstParser</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">/* ... */</span></span>
<span class="line">    <span class="token comment">// This Grammar rule has no custom user semantic actions</span></span>
<span class="line">    <span class="token comment">// So it would not throw an unexpected exception during the recording phase...</span></span>
<span class="line">    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;objectItem&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>StringLiteral<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>Colon<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      $<span class="token punctuation">.</span><span class="token constant">SUBRULE</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="the-solution-1" tabindex="-1"><a class="header-anchor" href="#the-solution-1"><span>The Solution</span></a></h4><p>The solution is to simply <strong>avoid executing any code that could raise such exceptions during the recording phase</strong>. This can be easily accomplished by wrapping the relevant semantic actions with the <a href="https://chevrotain.io/documentation/11_1_2/classes/BaseParser.html#ACTION" target="_blank" rel="noopener noreferrer">ACTION DSL method</a> For example, let&#39;s resolve the two scenarios shown above:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">SolvedEmbeddedActions1</span> <span class="token keyword">extends</span> <span class="token class-name">EmbeddedActionsParser</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">/* ... */</span></span>
<span class="line">    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;topRule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// During the recording phase `SUBRULE` will return a &quot;dummy&quot; value</span></span>
<span class="line">      <span class="token comment">// Which would not match the structure `otherRule` normally returns.</span></span>
<span class="line">      <span class="token keyword">const</span> otherRuleVal <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">SUBRULE</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>otherRule<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">return</span> $<span class="token punctuation">.</span><span class="token constant">ACTION</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Code inside `ACTION` will not be executed during the grammar recording phase.</span></span>
<span class="line">        <span class="token comment">// Therefore an error will **not** be thrown...</span></span>
<span class="line">        otherRuleVal<span class="token punctuation">.</span>foo<span class="token punctuation">.</span>bar<span class="token punctuation">;</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;otherRule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> myTok <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>MyTok<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">return</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token literal-property property">bar</span><span class="token operator">:</span> myTok<span class="token punctuation">.</span>image<span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">SolvedSemanticChecks</span> <span class="token keyword">extends</span> <span class="token class-name">EmbeddedActionsParser</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">/* ... */</span></span>
<span class="line">    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;semanticCheckRule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// During the recording phase `CONSUME` will return a &quot;dummy&quot; IToken value.</span></span>
<span class="line">      <span class="token keyword">const</span> myNumTok <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>NumberTok<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">// The &quot;dummy&quot; IToken `image` is not a number so this will evaluate to NaN.</span></span>
<span class="line">      <span class="token keyword">const</span> numValue <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>myNumTok<span class="token punctuation">.</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      $<span class="token punctuation">.</span><span class="token constant">ACTION</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// Code inside `ACTION` will not be executed during the grammar recording phase.</span></span>
<span class="line">        <span class="token comment">// Therefore an error will **not** be thrown...</span></span>
<span class="line">        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>numValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Unexpected Number Value!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">      <span class="token keyword">return</span> numValue<span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Note:</p><ul><li>Code wrapped by the <code>ACTION</code> wrapper <strong>must not</strong> include DSL method (MANY/OR/OPTION/...) calls, as this would prevent the grammar those methods represent from being recorded.</li><li>Not all semantic actions require wrapping in <code>ACTION</code> -- only those that would throw errors during the grammar recording phase.</li><li>Embedded actions reduce separation of concerns between parsing and semantics. However, we can still maintain some of this separation by performing the Parsing &quot;part&quot; at the beginning of the rule and the semantic actions &quot;part&quot; at the end of the rule.</li></ul><h3 id="assumption-2-there-are-no-lasting-side-effects-due-to-running-the-recording-phase" tabindex="-1"><a class="header-anchor" href="#assumption-2-there-are-no-lasting-side-effects-due-to-running-the-recording-phase"><span>Assumption 2 - There are no lasting side effects due to running the recording phase.</span></a></h3><p>If there are any <strong>lasting</strong> side effects from executing the parsing rules, then their execution during the grammar recording phase may break logic dependent on those side effects.</p><p>For example:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">let</span> ruleCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">class</span> <span class="token class-name">SideEffectsParser</span> <span class="token keyword">extends</span> <span class="token class-name">CstParser</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">/* ... */</span></span>
<span class="line">    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;myRule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// The counter will be incremented during the recording phase.</span></span>
<span class="line">      counter<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">      $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>MyToken<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SideEffectsParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// We expected this to be `0`...</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; 1</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="solutions" tabindex="-1"><a class="header-anchor" href="#solutions"><span>Solutions</span></a></h4><p>As before, one of the solutions is to wrap the relevant embedded semantic action using the <a href="https://chevrotain.io/documentation/11_1_2/classes/BaseParser.html#ACTION" target="_blank" rel="noopener noreferrer">ACTION DSL method</a>. This is normally most suitable for handling <strong>global state</strong> outside the Parser&#39;s instance.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">$<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;myRule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  $<span class="token punctuation">.</span><span class="token constant">ACTION</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// This code will no longer execute during the recording phase.</span></span>
<span class="line">    counter<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>MyToken<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Because we are dealing with state here, there is another option, which is to override the Parser&#39;s <a href="https://chevrotain.io/documentation/11_1_2/classes/CstParser.html#reset" target="_blank" rel="noopener noreferrer">reset method</a>. This is normally suitable for state that needs to be reset every time <strong>new input</strong> is provided to the parser.</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">class</span> <span class="token class-name">FixedSideEffectsParser</span> <span class="token keyword">extends</span> <span class="token class-name">CstParser</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">//</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>instanceCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token comment">/* ... */</span></span>
<span class="line">    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;myRule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// The counter will be incremented during the recording phase.</span></span>
<span class="line">      <span class="token keyword">this</span><span class="token punctuation">.</span>instanceCounter<span class="token operator">++</span><span class="token punctuation">;</span></span>
<span class="line">      $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>MyToken<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">  <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">this</span><span class="token punctuation">.</span>instanceCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FixedSideEffectsParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>parser<span class="token punctuation">.</span>instanceCounter<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// -&gt; 0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="debugging-implications" tabindex="-1"><a class="header-anchor" href="#debugging-implications"><span>Debugging Implications</span></a></h3><p>Due to the execution of the Parser rules during the &quot;recording phase&quot;, some breakpoints inside Chevrotain Parsers will be hit during the Parser&#39;s initialization.</p><p>It is possible to work around this issue by using <strong>conditional breakpoints</strong> that check whether the <a href="https://chevrotain.io/documentation/11_1_2/classes/BaseParser.html#RECORDING_PHASE" target="_blank" rel="noopener noreferrer">RECORDING_PHASE flag</a> is disabled.</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/chevrotain/chevrotain/edit/master/packages/website/docs/guide/internals.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]--><!--]-->Edit this page on GitHub<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><time class="meta-item-info" datetime="2026-02-27T19:21:23.000Z" data-allow-mismatch>2/27/26, 9:21 PM</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: shahars@protonmail.com">bd82</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: shahars@protonmail.com">Shahar Soel</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: shachar.soel@sap.com">i060847</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: shachar.soel@sap.com">I060847</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: graheja1997@gmail.com">Gaurav</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/docs/guide/syntactic_content_assist.html" aria-label="Syntactic Content Assist"><!--[--><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span class="external-link">Syntactic Content Assist</span></div><!--]--></a><a class="route-link auto-link next" href="/docs/guide/resolving_grammar_errors.html" aria-label="Resolving Grammar Errors"><!--[--><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span class="external-link">Resolving Grammar Errors</span></div><!--]--></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/docs/assets/app-BSd0-oVw.js" defer></script>
  </body>
</html>
