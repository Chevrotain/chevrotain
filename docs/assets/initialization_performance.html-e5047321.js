import{_ as o,r as p,o as i,c,a as n,b as s,d as e,e as t}from"./app-4bef62ab.js";const l={},u=n("h1",{id:"initialization-performance",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#initialization-performance","aria-hidden":"true"},"#"),s(" Initialization Performance")],-1),r=n("p",null,"Chevrotain is (mostly) a runtime tool (No code generation). This means there is a fair bit of logic happening every time a Chevrotain Parser or Lexer are initialized. In some use cases this overhead may need to be reduced as much as possible.",-1),d=n("h2",{id:"enabling-initialization-performance-tracing",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#enabling-initialization-performance-tracing","aria-hidden":"true"},"#"),s(" Enabling Initialization Performance Tracing")],-1),k={href:"https://chevrotain.io/documentation/11_0_1/interfaces/IParserConfig.html#traceInitPerf",target:"_blank",rel:"noopener noreferrer"},v=n("code",null,"IParserConfig.traceInitPerf",-1),m=t(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">InitTracingParser</span> <span class="token keyword">extends</span> <span class="token class-name">CstParser</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">// Note \`traceInitPerf\` may also accept numerical values</span>
      <span class="token literal-property property">traceInitPerf</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">performSelfAnalysis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">InitTracingParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Will print tracing info to the console.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),b={href:"https://chevrotain.io/documentation/11_0_1/interfaces/ILexerConfig.html#traceInitPerf",target:"_blank",rel:"noopener noreferrer"},h=n("code",null,"ILexerConfig.traceInitPerf",-1),g=t(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// Will print tracing info to the console.</span>
<span class="token keyword">new</span> <span class="token class-name">Lexer</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// Note \`traceInitPerf\` may also accept numerical values</span>
  <span class="token literal-property property">traceInitPerf</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="use-a-smaller-global-maxlookahead" tabindex="-1"><a class="header-anchor" href="#use-a-smaller-global-maxlookahead" aria-hidden="true">#</a> Use a smaller Global maxLookahead</h2><p>Chevrotain is a K tokens lookahead Parser, this means it peeks ahead (at most) K Tokens to determine the alternative to pick whenever it encounters a &quot;branching&quot; in the grammar.</p>`,3),f={href:"https://chevrotain.io/documentation/11_0_1/interfaces/IParserConfig.html#maxLookAhead",target:"_blank",rel:"noopener noreferrer"},_=n("strong",null,"exponentially",-1),y=t(`<p>Example:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">LowLookaheadParser</span> <span class="token keyword">extends</span> <span class="token class-name">CstParser</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">// By default this value is 3</span>
      <span class="token literal-property property">maxLookahead</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">performSelfAnalysis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Note that the global maxLookahead can be overridden for <strong>individual</strong> DSL methods(OR/OPTION/MANY/...) invocations, For example:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">LowLookaheadParser</span> <span class="token keyword">extends</span> <span class="token class-name">CstParser</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">// Globally **only one** token lookahead.</span>
      <span class="token literal-property property">maxLookahead</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      $<span class="token punctuation">.</span><span class="token constant">OR</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// We need **two** tokens lookahead to distinguish between these two alternatives</span>
        <span class="token constant">MAX_LOOKAHEAD</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token constant">DEF</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token function-variable function">ALT</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token function-variable function">ALT</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">performSelfAnalysis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="disabling-grammar-validations" tabindex="-1"><a class="header-anchor" href="#disabling-grammar-validations" aria-hidden="true">#</a> Disabling Grammar Validations</h2><p>Chevrotain performs many validations during Lexer &amp; Parser initialization, however those are not really relevant when the Lexer &amp; Parser are known to be valid, These validations are a <strong>development time</strong> tool, and not really needed during productive flows.</p>`,6),x={href:"https://chevrotain.io/documentation/11_0_1/interfaces/IParserConfig.html#skipValidations",target:"_blank",rel:"noopener noreferrer"},w=n("strong",null,"Parser",-1),P=t(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">NaiveSkippedValidationsParser</span> <span class="token keyword">extends</span> <span class="token class-name">CstParser</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">// This could reduce 30-50% of the initialization time</span>
      <span class="token literal-property property">skipValidations</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">performSelfAnalysis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),L={href:"https://chevrotain.io/documentation/11_0_1/interfaces/ILexerConfig.html#skipValidations",target:"_blank",rel:"noopener noreferrer"},C=n("strong",null,"Lexer",-1),I=t(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Lexer</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">skipValidations</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The examples above are a little naive, as the validations are <strong>always</strong> skipped, while we only need to skip them under specific conditions, for example:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">MoreRealisticSkippedValidationsParser</span> <span class="token keyword">extends</span> <span class="token class-name">CstParser</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">// only run the validations when a certain env variable is set.</span>
      <span class="token literal-property property">skipValidations</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">&quot;IN_MY_PACKAGE_LOCAL_TESTING&quot;</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token comment">// Always Trace init logs when in local testing to hopefully spot regressions.</span>
      <span class="token literal-property property">traceInitPerf</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">&quot;IN_MY_PACKAGE_LOCAL_TESTING&quot;</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">performSelfAnalysis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Note that in a real world scenario the special condition to enable validations/tracing could be anything:</p><ul><li>env variable.</li><li>command line argument.</li><li>existence of a certain config file in the CWD.</li><li>...</li></ul>`,5);function A(j,N){const a=p("ExternalLinkIcon");return i(),c("div",null,[u,r,d,n("p",null,[s("Measuring a Parser's initialization performance can be done by enabling the "),n("a",k,[v,e(a)]),s(" flag. For example:")]),m,n("p",null,[s("A Lexer's initialization performance can similarly be measured by enabling the "),n("a",b,[h,e(a)]),s(" flag:")]),g,n("p",null,[s("During initialization Chevrotain pre-computes and caches lookahead functions that would later be used at runtime. The global "),n("a",f,[s("maxLookahead"),e(a)]),s(' setting can significantly affect the performance of this pre-computation due to the fact the number of possible "paths" in the grammar can grow '),_,s(" as the max length of the possible paths increases.")]),y,n("p",null,[s("The "),n("a",x,[s("IParserConfig.skipValidations"),e(a)]),s(" config property can be used to avoid running these validations during "),w,s(" initialization.")]),P,n("p",null,[s("Similarly the "),n("a",L,[s("ILexerConfig.skipValidations"),e(a)]),s(" config property can be used to skip the optional validations during "),C,s(" initialization.")]),I])}const z=o(l,[["render",A],["__file","initialization_performance.html.vue"]]);export{z as default};
