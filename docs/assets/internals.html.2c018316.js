import{_ as i,o as l,c as u,a as s,b as a,w as p,d as t,e as n,r as c}from"./app.23f00f41.js";const r={},d=t('<h1 id="internals" tabindex="-1"><a class="header-anchor" href="#internals" aria-hidden="true">#</a> Internals</h1><p>Chevrotain provides an abstraction for building Parsers, however no abstraction is prefect and at some point understand the implementation details may become necessary.</p><h2 id="grammar-recording" tabindex="-1"><a class="header-anchor" href="#grammar-recording" aria-hidden="true">#</a> Grammar Recording</h2><h4 id="tldr" tabindex="-1"><a class="header-anchor" href="#tldr" aria-hidden="true">#</a> TLDR</h4>',4),k=n("Wrap any semantic actions that cause runtime errors during the recording phase or have global side effects with the "),m={href:"https://chevrotain.io/documentation/10_5_0/classes/BaseParser.html#ACTION",target:"_blank",rel:"noopener noreferrer"},v=n("ACTION DSL method"),h=n(" to resolve issues."),b=t(`<h3 id="the-problem" tabindex="-1"><a class="header-anchor" href="#the-problem" aria-hidden="true">#</a> The Problem</h3><p><strong><em>Chevrotain needs to &quot;understand&quot; the grammar structure in order to run.</em></strong></p><p>For example, in an alternation Chevrotain must able to choose the right alternative process, but in order to do so the <strong>contents</strong> (Grammar) of each alternative must be known <strong>in advance</strong>.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>$<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// The choice of which alternative to pick</span>
  <span class="token comment">// is done by the &quot;OR&quot; (alternation) method, by **looking ahead** in the token vector.</span>
  <span class="token comment">// But making this choice requires **knowing** in advance the full structure of the grammar.</span>
  $<span class="token punctuation">.</span><span class="token constant">OR</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span> <span class="token function-variable function">ALT</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>StringLiteral<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token function-variable function">ALT</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>NumberLiteral<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token function-variable function">ALT</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">SUBRULE</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>object<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token function-variable function">ALT</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">SUBRULE</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>array<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token function-variable function">ALT</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>True<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token function-variable function">ALT</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>False<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token function-variable function">ALT</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>Null<span class="token punctuation">)</span> <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="the-solution" tabindex="-1"><a class="header-anchor" href="#the-solution" aria-hidden="true">#</a> The Solution</h3>`,5),g=n('Chevrotain solves the problem of "understanding" the grammar structure by running the Parser in a "Recording Mode" with '),y=s("strong",null,"alternative implementations",-1),f=n(' of the parsing methods (OR/MANY/OPTION/...), the results of these "recordings" are saved on the Parser instance and are accessible via the '),w={href:"https://chevrotain.io/documentation/10_5_0/classes/BaseParser.html#getGAstProductions",target:"_blank",rel:"noopener noreferrer"},_=n("getGastProductions"),T=n(" method. However for this to work successfully there are a couple of implicit assumptions.."),E=t(`<h3 id="assumption-1-the-parser-won-t-throw-errors-during-recording" tabindex="-1"><a class="header-anchor" href="#assumption-1-the-parser-won-t-throw-errors-during-recording" aria-hidden="true">#</a> Assumption 1 - The Parser won&#39;t throw errors during recording.</h3><p>Any error thrown during the recording phase will obviously fail the recording and thus make the parser un-usable. These are normally easy to fix and identify by an end user as the runtime error message will be modified (By Chevrotain) to indicate it occurred during the &quot;recording phase&quot; and the stack trace will easily &quot;point&quot; the end user towards the source of the problem.</p><p>let us inspect some scenarios to fully understand the problem. The root issue is making assumptions on the structure and values returned by the Parsing DSL methods. Lets first consider an example that will <strong>not</strong> cause an error.</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">SafeEmbeddedActionsExample</span> <span class="token keyword">extends</span> <span class="token class-name">EmbeddedActionsParser</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;objectItem&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// Usage of the Parsing DSL methods is always safe, otherwise the whole concept of &quot;grammar recording&quot; would not work...</span>
      <span class="token keyword">const</span> keyTok <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>StringLiteral<span class="token punctuation">)</span>
      $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>Colon<span class="token punctuation">)</span>
      <span class="token keyword">const</span> valAst <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">SUBRULE</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>value<span class="token punctuation">)</span>

      <span class="token comment">// strip away the quotes from the string literal</span>
      <span class="token comment">// Note that even during the &quot;recording phase&quot; the CONSUME method will return an object that matches the IToken interface</span>
      <span class="token comment">// to reduce potential runtime errors, so this is safe.</span>
      <span class="token keyword">const</span> keyName <span class="token operator">=</span> keyTok<span class="token punctuation">.</span>image<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> keyTok<span class="token punctuation">.</span>image<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>

      <span class="token comment">// Assembling this JS object literal won&#39;t cause any issues because</span>
      <span class="token comment">// we are not actually doing anything with the returned values.</span>
      <span class="token comment">// Only assigning them to properties in a new object (which is always safe)</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;keyValuePair&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">key</span><span class="token operator">:</span> keyName<span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> valAst
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>So we saw that a common use case of using embedded semantic actions to construct an AST is normally safe during the &quot;recording&quot; phase. Let&#39;s consider some situations that will actually cause errors.</p><h4 id="example-1-making-assumptions-on-the-returned-structure-by-a-subrule-call" tabindex="-1"><a class="header-anchor" href="#example-1-making-assumptions-on-the-returned-structure-by-a-subrule-call" aria-hidden="true">#</a> Example 1: Making assumptions on the returned structure by a SUBRULE call</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">ErrorEmbeddedActions1</span> <span class="token keyword">extends</span> <span class="token class-name">EmbeddedActionsParser</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;topRule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// During the recording phase \`SUBRULE\` will return a &quot;dummy&quot; value</span>
      <span class="token comment">// Which would not match the structure \`otherRule\` normally returns.</span>
      <span class="token keyword">const</span> otherRuleVal <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">SUBRULE</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>otherRule<span class="token punctuation">)</span>

      <span class="token comment">// Will cause &quot;undefined is not an object&quot; runtime error</span>
      <span class="token comment">// because during the recording phase \`SUBRULE\` will not returned the expected value.</span>
      <span class="token keyword">return</span> otherRuleVal<span class="token punctuation">.</span>foo<span class="token punctuation">.</span>bar
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;otherRule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> myTok <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>MyTok<span class="token punctuation">)</span>

      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">bar</span><span class="token operator">:</span> myTok<span class="token punctuation">.</span>image
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="example-2-making-assumptions-on-the-returned-value-by-dsl-method-calls" tabindex="-1"><a class="header-anchor" href="#example-2-making-assumptions-on-the-returned-value-by-dsl-method-calls" aria-hidden="true">#</a> Example 2: Making assumptions on the returned value by DSL Method calls</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">ErrorSemanticChecks</span> <span class="token keyword">extends</span> <span class="token class-name">EmbeddedActionsParser</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;semanticCheckRule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// During the recording phase \`CONSUME\` will return a &quot;dummy&quot; IToken value.</span>
      <span class="token keyword">const</span> myNumTok <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>NumberTok<span class="token punctuation">)</span>
      <span class="token comment">// The &quot;dummy&quot; IToken \`image\` is not a number so this will evaluate to NaN.</span>
      <span class="token keyword">const</span> numValue <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>myNumTok<span class="token punctuation">.</span>image<span class="token punctuation">)</span>

      <span class="token comment">// Our embedded semantic check will **always** throw during the recording phase because</span>
      <span class="token comment">// the &quot;mocked&quot; IToken returned by \`CONSUME\` would never be a valid integer.</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>numValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Unexpected Number Value!&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> numValue
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="common-denominator-embedded-actions" tabindex="-1"><a class="header-anchor" href="#common-denominator-embedded-actions" aria-hidden="true">#</a> Common Denominator: Embedded Actions</h4>`,10),q=n("Before moving on to possible solutions, note that all the above examples are centered around using Parsers with "),x=s("strong",null,"embedded actions",-1),N=n(". When using the alternative: a Parser that outputs a "),C=n("Concrete Syntax Tree"),S=n(" which is the "),U=n("recommended approach"),R=n(", there would be very few (if any) embedded actions in the grammar. Thus it is a lot less likely that a CSTParser would raise errors during the recording phase, e.g:"),L=t(`<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">JsonParser</span> <span class="token keyword">extends</span> <span class="token class-name">CstParser</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
    <span class="token comment">// This Grammar rule has no custom user semantic actions</span>
    <span class="token comment">// So it would not throw an unexpected exception during the recording phase...</span>
    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;objectItem&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>StringLiteral<span class="token punctuation">)</span>
      $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>Colon<span class="token punctuation">)</span>
      $<span class="token punctuation">.</span><span class="token constant">SUBRULE</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="the-solution-1" tabindex="-1"><a class="header-anchor" href="#the-solution-1" aria-hidden="true">#</a> The Solution</h4>`,2),O=n("The solution is to simply "),$=s("strong",null,"avoid executing any code that could raise such exceptions during the recording phase",-1),A=n(". This can be easily accomplished by wrapping the relevant semantic actions with the "),P={href:"https://chevrotain.io/documentation/10_5_0/classes/BaseParser.html#ACTION",target:"_blank",rel:"noopener noreferrer"},j=n("ACTION DSL method"),I=n(" for example lets resolve the two scenarios shown above:"),M=t(`<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">SolvedEmbeddedActions1</span> <span class="token keyword">extends</span> <span class="token class-name">EmbeddedActionsParser</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;topRule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// During the recording phase \`SUBRULE\` will return a &quot;dummy&quot; value</span>
      <span class="token comment">// Which would not match the structure \`otherRule\` normally returns.</span>
      <span class="token keyword">const</span> otherRuleVal <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">SUBRULE</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span>otherRule<span class="token punctuation">)</span>

      <span class="token keyword">return</span> $<span class="token punctuation">.</span><span class="token constant">ACTION</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// Code inside \`ACTION\` will not be executed during the grammar recording phase.</span>
        <span class="token comment">// Therefore an error will **not** be thrown...</span>
        otherRuleVal<span class="token punctuation">.</span>foo<span class="token punctuation">.</span>bar
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;otherRule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> myTok <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>MyTok<span class="token punctuation">)</span>

      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">bar</span><span class="token operator">:</span> myTok<span class="token punctuation">.</span>image
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">SolvedSemanticChecks</span> <span class="token keyword">extends</span> <span class="token class-name">EmbeddedActionsParser</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;semanticCheckRule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// During the recording phase \`CONSUME\` will return a &quot;dummy&quot; IToken value.</span>
      <span class="token keyword">const</span> myNumTok <span class="token operator">=</span> $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>NumberTok<span class="token punctuation">)</span>
      <span class="token comment">// The &quot;dummy&quot; IToken \`image\` is not a number so this will evaluate to NaN.</span>
      <span class="token keyword">const</span> numValue <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>myNumTok<span class="token punctuation">.</span>image<span class="token punctuation">)</span>

      $<span class="token punctuation">.</span><span class="token constant">ACTION</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// Code inside \`ACTION\` will not be executed during the grammar recording phase.</span>
        <span class="token comment">// Therefore an error will **not** be thrown...</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isNaN</span><span class="token punctuation">(</span>numValue<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Unexpected Number Value!&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token keyword">return</span> numValue
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Note:</p><ul><li>Code wrapper by the <code>ACTION</code> wrapper <strong>must not</strong> include DSL methods (MANY/OR/OPTION/...) calls as this would prevent those the grammar those methods represent from being recorded.</li><li>Not all semantic actions require wrapping in <code>ACTION</code>, only those that would throw errors during the grammar recording phase.</li><li>Embedded actions reduce separation of concerns between parsing and semantics. However we can still maintain some of this separation by performing the Parsing &quot;part&quot; at the beginning of the rule and the semantic actions &quot;part&quot; at the end of the rule.</li></ul><h3 id="assumption-2-there-are-no-lasting-side-effects-due-to-running-the-recording-phase" tabindex="-1"><a class="header-anchor" href="#assumption-2-there-are-no-lasting-side-effects-due-to-running-the-recording-phase" aria-hidden="true">#</a> Assumption 2 - There are no lasting side effects due to running the recording phase.</h3><p>If there are any <strong>lasting</strong> side effects from executing the parsing rules then their execution during the grammar recording phase may break logic dependent on those side effects.</p><p>For example:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> ruleCounter <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">class</span> <span class="token class-name">SideEffectsParser</span> <span class="token keyword">extends</span> <span class="token class-name">CstParser</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* ... */</span>
    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;myRule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// The counter will be incremented during the recording phase.</span>
      counter<span class="token operator">++</span>
      $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>MyToken<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SideEffectsParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// We expected this to be \`0\`...</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span> <span class="token comment">// -&gt; 1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="solutions" tabindex="-1"><a class="header-anchor" href="#solutions" aria-hidden="true">#</a> Solutions</h4>`,9),B=n("As before one of the solutions will be to wrap the relevant embedded semantic action using the "),D={href:"https://chevrotain.io/documentation/10_5_0/classes/BaseParser.html#ACTION",target:"_blank",rel:"noopener noreferrer"},V=n("ACTION DSL method"),G=n(". This is normally most suitable for handling "),W=s("strong",null,"global state",-1),F=n(" outside the Parser's instance."),H=t(`<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>$<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;myRule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  $<span class="token punctuation">.</span><span class="token constant">ACTION</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// This code will no longer execute during the recording phase.</span>
    counter<span class="token operator">++</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>MyToken<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1),J=n("Because we are dealing with state here there is another option which is to override the Parser's "),Y={href:"https://chevrotain.io/documentation/10_5_0/classes/CstParser.html#reset",target:"_blank",rel:"noopener noreferrer"},z=n("reset method"),K=n(". This is normally suitable for state that needs to be reset every time "),Q=s("strong",null,"new input",-1),X=n(" provided to the parser."),Z=t(`<div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">FixedSideEffectsParser</span> <span class="token keyword">extends</span> <span class="token class-name">CstParser</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>instanceCounter <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment">/* ... */</span>
    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;myRule&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// The counter will be incremented during the recording phase.</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>instanceCounter<span class="token operator">++</span>
      $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span>MyToken<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>instanceCounter <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FixedSideEffectsParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>parser<span class="token punctuation">.</span>instanceCounter<span class="token punctuation">)</span> <span class="token comment">// -&gt; 0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="debugging-implications" tabindex="-1"><a class="header-anchor" href="#debugging-implications" aria-hidden="true">#</a> Debugging Implications</h3><p>Due to the execution of the Parser rules during the &quot;recording phase&quot;. Some break points inside Chevrotain Parsers will be hit during the Parser&#39;s initialization.</p>`,3),nn=n("It is possible to workaround this issue by using "),sn=s("strong",null,"conditional breakpoints",-1),an=n(" that inspect that the "),tn={href:"https://chevrotain.io/documentation/10_5_0/classes/BaseParser.html#RECORDING_PHASE",target:"_blank",rel:"noopener noreferrer"},en=n("RECORDING_PHASE flag"),on=n(" is disabled.");function pn(cn,ln){const e=c("ExternalLinkIcon"),o=c("RouterLink");return l(),u("div",null,[d,s("p",null,[k,s("a",m,[v,a(e)]),h]),b,s("p",null,[g,y,f,s("a",w,[_,a(e)]),T]),E,s("p",null,[q,x,N,a(o,{to:"/guide/concrete_syntax_tree.html"},{default:p(()=>[C]),_:1}),S,a(o,{to:"/tutorial/step3_adding_actions_root.html#alternatives"},{default:p(()=>[U]),_:1}),R]),L,s("p",null,[O,$,A,s("a",P,[j,a(e)]),I]),M,s("p",null,[B,s("a",D,[V,a(e)]),G,W,F]),H,s("p",null,[J,s("a",Y,[z,a(e)]),K,Q,X]),Z,s("p",null,[nn,sn,an,s("a",tn,[en,a(e)]),on])])}var rn=i(r,[["render",pn],["__file","internals.html.vue"]]);export{rn as default};
