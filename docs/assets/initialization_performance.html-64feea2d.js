import{_ as o,r as i,o as l,c,b as s,d as a,e,a as p}from"./app-c52f5eff.js";const u={},r={href:"https://chevrotain.io/documentation/11_1_0/interfaces/IParserConfig.html#traceInitPerf",target:"_blank",rel:"noopener noreferrer"},d={href:"https://chevrotain.io/documentation/11_1_0/interfaces/ILexerConfig.html#traceInitPerf",target:"_blank",rel:"noopener noreferrer"},k={href:"https://chevrotain.io/documentation/11_1_0/interfaces/IParserConfig.html#maxLookAhead",target:"_blank",rel:"noopener noreferrer"},v={href:"https://chevrotain.io/documentation/11_1_0/interfaces/IParserConfig.html#skipValidations",target:"_blank",rel:"noopener noreferrer"},m={href:"https://chevrotain.io/documentation/11_1_0/interfaces/ILexerConfig.html#skipValidations",target:"_blank",rel:"noopener noreferrer"};function b(g,n){const t=i("ExternalLinkIcon");return l(),c("div",null,[n[21]||(n[21]=s("h1",{id:"initialization-performance",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#initialization-performance","aria-hidden":"true"},"#"),a(" Initialization Performance")],-1)),n[22]||(n[22]=s("p",null,"Chevrotain is (mostly) a runtime tool (No code generation). This means there is a fair bit of logic happening every time a Chevrotain Parser or Lexer are initialized. In some use cases this overhead may need to be reduced as much as possible.",-1)),n[23]||(n[23]=s("h2",{id:"enabling-initialization-performance-tracing",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#enabling-initialization-performance-tracing","aria-hidden":"true"},"#"),a(" Enabling Initialization Performance Tracing")],-1)),s("p",null,[n[1]||(n[1]=a("Measuring a Parser's initialization performance can be done by enabling the ")),s("a",r,[n[0]||(n[0]=s("code",null,"IParserConfig.traceInitPerf",-1)),e(t)]),n[2]||(n[2]=a(" flag. For example:"))]),n[24]||(n[24]=p(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">InitTracingParser</span> <span class="token keyword">extends</span> <span class="token class-name">CstParser</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">// Note \`traceInitPerf\` may also accept numerical values</span>
      <span class="token literal-property property">traceInitPerf</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">performSelfAnalysis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">new</span> <span class="token class-name">InitTracingParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Will print tracing info to the console.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1)),s("p",null,[n[4]||(n[4]=a("A Lexer's initialization performance can similarly be measured by enabling the ")),s("a",d,[n[3]||(n[3]=s("code",null,"ILexerConfig.traceInitPerf",-1)),e(t)]),n[5]||(n[5]=a(" flag:"))]),n[25]||(n[25]=p(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// Will print tracing info to the console.</span>
<span class="token keyword">new</span> <span class="token class-name">Lexer</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// Note \`traceInitPerf\` may also accept numerical values</span>
  <span class="token literal-property property">traceInitPerf</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="use-a-smaller-global-maxlookahead" tabindex="-1"><a class="header-anchor" href="#use-a-smaller-global-maxlookahead" aria-hidden="true">#</a> Use a smaller Global maxLookahead</h2><p>Chevrotain is a K tokens lookahead Parser, this means it peeks ahead (at most) K Tokens to determine the alternative to pick whenever it encounters a &quot;branching&quot; in the grammar.</p>`,3)),s("p",null,[n[7]||(n[7]=a("During initialization Chevrotain pre-computes and caches lookahead functions that would later be used at runtime. The global ")),s("a",k,[n[6]||(n[6]=a("maxLookahead")),e(t)]),n[8]||(n[8]=a(' setting can significantly affect the performance of this pre-computation due to the fact the number of possible "paths" in the grammar can grow ')),n[9]||(n[9]=s("strong",null,"exponentially",-1)),n[10]||(n[10]=a(" as the max length of the possible paths increases."))]),n[26]||(n[26]=p(`<p>Example:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">LowLookaheadParser</span> <span class="token keyword">extends</span> <span class="token class-name">CstParser</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">// By default this value is 3</span>
      <span class="token literal-property property">maxLookahead</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">performSelfAnalysis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Note that the global maxLookahead can be overridden for <strong>individual</strong> DSL methods(OR/OPTION/MANY/...) invocations, For example:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">LowLookaheadParser</span> <span class="token keyword">extends</span> <span class="token class-name">CstParser</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">// Globally **only one** token lookahead.</span>
      <span class="token literal-property property">maxLookahead</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    $<span class="token punctuation">.</span><span class="token constant">RULE</span><span class="token punctuation">(</span><span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      $<span class="token punctuation">.</span><span class="token constant">OR</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">// We need **two** tokens lookahead to distinguish between these two alternatives</span>
        <span class="token constant">MAX_LOOKAHEAD</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token constant">DEF</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token function-variable function">ALT</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span><span class="token constant">B</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token function-variable function">ALT</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
              $<span class="token punctuation">.</span><span class="token constant">CONSUME</span><span class="token punctuation">(</span><span class="token constant">C</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">performSelfAnalysis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="disabling-grammar-validations" tabindex="-1"><a class="header-anchor" href="#disabling-grammar-validations" aria-hidden="true">#</a> Disabling Grammar Validations</h2><p>Chevrotain performs many validations during Lexer &amp; Parser initialization, however those are not really relevant when the Lexer &amp; Parser are known to be valid, These validations are a <strong>development time</strong> tool, and not really needed during productive flows.</p>`,6)),s("p",null,[n[12]||(n[12]=a("The ")),s("a",v,[n[11]||(n[11]=a("IParserConfig.skipValidations")),e(t)]),n[13]||(n[13]=a(" config property can be used to avoid running these validations during ")),n[14]||(n[14]=s("strong",null,"Parser",-1)),n[15]||(n[15]=a(" initialization."))]),n[27]||(n[27]=p(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">NaiveSkippedValidationsParser</span> <span class="token keyword">extends</span> <span class="token class-name">CstParser</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">// This could reduce 30-50% of the initialization time</span>
      <span class="token literal-property property">skipValidations</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">performSelfAnalysis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,1)),s("p",null,[n[17]||(n[17]=a("Similarly the ")),s("a",m,[n[16]||(n[16]=a("ILexerConfig.skipValidations")),e(t)]),n[18]||(n[18]=a(" config property can be used to skip the optional validations during ")),n[19]||(n[19]=s("strong",null,"Lexer",-1)),n[20]||(n[20]=a(" initialization."))]),n[28]||(n[28]=p(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">new</span> <span class="token class-name">Lexer</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">skipValidations</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>The examples above are a little naive, as the validations are <strong>always</strong> skipped, while we only need to skip them under specific conditions, for example:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">class</span> <span class="token class-name">MoreRealisticSkippedValidationsParser</span> <span class="token keyword">extends</span> <span class="token class-name">CstParser</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token comment">// only run the validations when a certain env variable is set.</span>
      <span class="token literal-property property">skipValidations</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">&quot;IN_MY_PACKAGE_LOCAL_TESTING&quot;</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token comment">// Always Trace init logs when in local testing to hopefully spot regressions.</span>
      <span class="token literal-property property">traceInitPerf</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">[</span><span class="token string">&quot;IN_MY_PACKAGE_LOCAL_TESTING&quot;</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">performSelfAnalysis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Note that in a real world scenario the special condition to enable validations/tracing could be anything:</p><ul><li>env variable.</li><li>command line argument.</li><li>existence of a certain config file in the CWD.</li><li>...</li></ul>`,5))])}const h=o(u,[["render",b],["__file","initialization_performance.html.vue"]]);export{h as default};
